# 自走棋自动战斗 - 游戏深度体验报告

**测试日期**: 2026-02-28
**版本**: v0.3.0 - Phase B+
**测试范围**: 全流程体验 + 代码审查 + 数据完整性审计
**测试团队**: 5个专项测试员(主菜单/流程/战斗/场景/数据) + 团队总指挥

---

## 一、总体评价

游戏核心玩法闭环已通：主菜单 → 难度选择 → 英雄选择 → 地图探索 → 战斗 → 奖励 → 继续冒险。
UI全中文化完成度高，战斗系统自动运行流畅，地图生成和节点类型丰富。
但存在若干影响体验的问题需要修复，尤其是**英雄解锁缺失**、**重复操作防护缺失**、**布局溢出**等。

### 评分概览

| 模块 | 评分 | 说明 |
|------|------|------|
| 主菜单 | ★★★★☆ | 功能完整，升级面板缺遮罩 |
| 英雄选择 | ★★★☆☆ | 功能可用，布局溢出，解锁数据缺失 |
| 地图场景 | ★★★★☆ | 节点丰富，交互良好，英雄面板可点击 |
| 战斗系统 | ★★★★☆ | 自动战斗流畅，UI布局已修复 |
| 商店/事件/休息 | ★★★☆☆ | 功能可用，缺少重复操作防护 |
| 数据完整性 | ★★☆☆☆ | 14名英雄缺少解锁条件，多处数据不一致 |
| 音频系统 | ★★★★☆ | 所有音频加载正常，BGM切换有效 |

---

## 二、各模块详细测试结果

### 2.1 主菜单 (MainMenuScene)

**测试结果**: 通过

- 标题 "自走棋 / 自动战斗" 显示正确
- 副标题 "自动战斗 | 策略 | 冒险" 正常
- 按钮: 继续(有存档时)、新游戏、升级、成就、帮助 — 全部可交互
- 右上角音频开关 "音乐:开 / 音效:开" 和 "[设置]" 可用
- 底部统计: "冒险:0 | 胜利:0 | 英雄:3/5 | 灵魂:0"
- 难度选择面板: 普通/困难(可用) + 噩梦/地狱(锁定) — 显示正确

**发现的问题**:

| # | 严重程度 | 描述 |
|---|---------|------|
| M-1 | 中等 | 升级面板缺少全屏遮罩层，背景元素透出可见 |
| M-2 | 轻微 | "英雄: 3/5" 分母硬编码为5，应反映实际可解锁英雄总数(19) |

### 2.2 英雄选择 (HeroDraftScene)

**测试结果**: 部分通过

- 标题 "选择初始英雄" + 副标题 "选择2-3名英雄开始冒险" 正常
- 2行网格布局(上行10张 + 下行9张)
- 已解锁英雄(3个): 铁甲骑士、疾风弓手、烈焰法师 — 显示名字、职业、元素、属性
- 未解锁英雄(16个): 显示🔒图标 + "未解锁"文字
- 选中机制: 黄色边框 + 计数器更新 (0/3 → 1/3 → 2/3 → 3/3)
- 底部: "返回" + 已选计数 + "开始冒险"(≥2人后启用)

**发现的问题**:

| # | 严重程度 | 描述 |
|---|---------|------|
| H-1 | 严重 | **第一张英雄卡片(铁甲骑士) x=-14，超出画布左边界**。Row1 10张卡片总宽 = 10×(86+6)-6 = 914px，画布宽800px，导致两侧各溢出约57px |
| H-2 | 严重 | **仅3名英雄可解锁**。19名英雄中有14名缺少解锁条件(MetaManager.HERO_UNLOCK_CONDITIONS中未注册)，玩家几乎无法体验大部分英雄 |
| H-3 | 中等 | 英雄卡片的HP/攻/防/速度等统计文本使用 `this.add.text(cx, cy+...)` 添加到场景而非容器中，导致拖拽/滚动时这些文本不会跟随卡片移动 |

**布局修复建议**: 将 COLS 从 10 改为 9(或7)，使行宽不超过 800px。或改为可滚动的网格。

### 2.3 地图场景 (MapScene)

**测试结果**: 通过

- 顶部信息栏: "英雄:3 遗物:0 进度:0/50" | "冒险地图" | "80G" — 正常
- 章节标题: "第1章: 魔法森林 - 第1层" — 正常
- 地图节点: 战斗(红)、商店(绿)、事件(紫)、休息(蓝)、首领(暗红) — 颜色区分清晰
- 可达节点: 高亮 + 脉冲动画 + 手型光标 — 交互反馈良好
- 已完成节点: 灰色 + ✓标记 + 白色当前位置环 — 状态清晰
- 节点连线: 在完成节点后可见
- 底部英雄面板: 3个英雄槽位，显示名字、等级、HP条、装备指示(W/A/R)
- 英雄面板可点击查看详情 — 功能正常

**发现的问题**:

| # | 严重程度 | 描述 |
|---|---------|------|
| MAP-1 | 轻微 | 地图总宽度2420px，首次进入时左侧节点可见但无明显拖拽提示，新手可能不知道地图可拖动 |
| MAP-2 | 轻微 | 初始状态下节点连线不太明显（较浅的颜色），完成节点后才显示清晰连线 |
| MAP-3 | 轻微 | 英雄面板装备槽使用英文标签'W','A','R'，i18n中已有SLOT_LABELS中文版本(武器/护甲/饰品) |

**地图节点分布** (52节点样本):
- 战斗: 23个(44%) | 事件: 13个(25%) | 商店: 8个(15%) | 休息: 3个(6%) | 首领: 3个(6%) | 精英: 2个(4%)

### 2.4 战斗系统 (BattleScene)

**测试结果**: 通过

- **加速按钮**: 位于顶部中间偏右("战斗 [1x]")，**不再被技能栏遮挡** — Task 1修复验证成功
- **技能栏**: 位于底部中间，显示英雄技能(多重射、穿透箭、火球术、烈焰波、盾击、嘲讽怒)，带快捷键标签
- **英雄血条**: 左上角显示3名英雄迷你HP条 — 正常
- **敌人血条**: 右上角显示敌人HP条 — 正常
- **羁绊指示**: 左侧英雄血条下方显示"2"(表示当前激活的羁绊数) — 不再与底部重叠
- **战斗过程**: 单位移动、攻击、释放技能(火球术等)，伤害数字弹出(129等)，效果正常
- **战斗结算**: 胜利后显示金币、经验、存活者、战斗统计 — 数据正确

**战斗数据验证** (battle-tester):
- 两次战斗数据合理: 疾风弓手(射手)输出远高于铁甲骑士(坦克)，符合角色定位
- 战斗场地修饰器正常显示(如"森林秘境：每15秒全体治疗5%")
- 速度设置(1x/2x/3x)通过SaveManager持久化保存
- 技能栏最多8槽，显示快捷键1-8
- 威胁/治疗指示线可切换、伤害统计面板可折叠

**发现的问题**:

| # | 严重程度 | 描述 |
|---|---------|------|
| B-1 | 轻微 | 初始战斗(3v少量敌人)结束非常快(不到2秒)，玩家可能来不及看清战斗过程。建议考虑给早期战斗增加最低持续时间 |
| B-2 | 轻微 | 地图第一个节点有时是商店而非战斗，新手在首战前进入商店可能无法购买(金币不足) |

### 2.5 奖励场景 (RewardScene)

**测试结果**: 通过

- 标题 "胜利！" 显示正确
- 金币/经验奖励、存活者信息、HP状态 — 全部正确
- 战斗统计表: 伤害/治疗/击杀 — 颜色区分(红/绿/白)
- "继续"按钮 — 正常

**发现的问题**:

| # | 严重程度 | 描述 |
|---|---------|------|
| R-1 | 中等 | 当英雄≥5人时布局可能溢出。英雄状态(5×20px) + 战斗统计表(~85px)末行y≈399会与底部金币文本(y=370)重叠 |
| R-2 | 严重 | **控制台报错**: `Cannot read properties of undefined (reading 'goldEarned')` at RewardScene.ts:44 — 在某些情况下battleResult数据未正确传递 |

### 2.6 商店场景 (ShopScene) — 浏览器测试 + 代码审查

**测试结果** (scene-tester): 通过

- 标题 "商店" 绿色大字 + 右上角金币显示 — 正常
- 英雄选择区: "选择英雄:" + 英雄按钮 — 正常
- 物品卡片: 2行3列，每卡包含稀有度圆点、物品名(颜色按稀有度)、槽位标签、描述、属性加成、价格、购买按钮 — 信息完整
- 稀有度颜色区分清晰(普通白/稀有绿/精良紫)
- 装备对比: 选英雄后显示▲/▼箭头(绿=提升/红=降低/黄=混合) — 直观
- 错误提示: 未选英雄时提示"请先选择英雄"，金币不足时提示 — 合理
- 离开商店: 标记节点完成 + 自动保存 + 返回地图 — 正常
- 文字全中文化 — 通过

**发现的问题**:

| # | 严重程度 | 描述 |
|---|---------|------|
| S-1 | 中等 | **已售商品可重复购买**。buyItem()未检查sold状态，购买后只做视觉淡出(alpha:0.3)但未调用disableInteractive()。快速点击可能重复触发 |
| S-2 | 轻微 | 英雄选择按钮使用pointerdown而非pointerup，与Button组件约定不一致 |

### 2.7 事件场景 (EventScene) — 浏览器测试 + 代码审查

**测试结果** (scene-tester): 通过

- 电影式进场动画(letterbox → 标题淡入 → 描述淡入 → 黑边退出 → 选项逐个弹入) — 体验良好
- 标题紫色大字 + 事件描述 + 金币显示 — 正常
- 选项按钮交互正常，概率提示显示(如"70% 有利 | 30% 有利")
- 效果类型完整: gold/heal/damage/stat_boost/relic/item/transform/sacrifice/recruit
- 结果展示: 淡出 → 结果描述 + 效果文字 + 情绪闪光(绿=好/红=差/黄=风险)
- 文字全中文化 — 通过

**发现的问题**:

| # | 严重程度 | 描述 |
|---|---------|------|
| E-1 | 严重 | **事件选项可重复触发**。makeChoice()无重入防护，动画过渡期间再次点击会导致效果双重执行(金币扣除、英雄献祭等) |
| E-2 | 中等 | stat_boost效果直接修改hero.exp(第208行)，绕过RunManager.addExp的升级检测逻辑，经验足够时不会触发自动升级 |
| E-3 | 中等 | 'item'类型事件效果仅给金币(第218行)，实际未给物品，描述与效果不符 |
| E-4 | 中等 | children.removeAll()不销毁对象(第254行)，可能导致事件监听器和粒子未清理 |
| E-5 | 轻微 | 多个中文字符串(风险/危险/有利/无事/元素转化/献祭/招募)未纳入i18n模块 |
| E-6 | 轻微 | 某些事件概率提示文字歧义: 两个结果都显示"有利"(getOutcomeSentiment分类可能过于宽泛) |

### 2.8 休息场景 (RestScene) — 浏览器测试 + 代码审查

**测试结果** (scene-tester): 通过

- 标题 "休息" 浅蓝色 + 描述 "你的队伍在篝火旁休息..." — 正常
- 篝火粒子效果(ParticleManager) — 视觉效果好
- 队伍状态: 每个英雄显示HP，颜色分级(>60%绿/30%橙/≤30%红) — 直观
- "休息 (恢复30%生命)" 绿色按钮 — 功能正常
- 恢复后: 治疗粒子特效 + 更新HP + "继续"按钮 — 正常
- 文字全中文化 — 通过

**发现的问题**:

| # | 严重程度 | 描述 |
|---|---------|------|
| REST-1 | 中等 | 休息按钮无重复点击防护，动画期间再次点击会重复执行healAllHeroes |
| REST-2 | 轻微 | ParticleManager实例创建后未保存引用，场景切换时可能未正确清理 |

### 2.9 设置场景 (SettingsScene) — 代码审查

**发现的问题**:

| # | 严重程度 | 描述 |
|---|---------|------|
| SET-1 | 严重 | **键盘重绑定事件监听器泄漏**。startRebind()在canvas上添加keydown监听器，但场景退出时无shutdown()清理。若玩家在5秒超时前离开设置，监听器永久泄漏到canvas |
| SET-2 | 中等 | 可同时打开多个重绑定会话(快速点击多个键位)，导致多个keydown监听器同时触发 |
| SET-3 | 中等 | SettingsScene是唯一没有shutdown()方法的场景，无法清理tween和事件 |
| SET-4 | 轻微 | '色盲模式'、'重置'、'[按键...]'等字符串未通过i18n获取 |

---

## 三、数据完整性审计

### 3.1 英雄解锁条件 (严重)

**MetaManager.HERO_UNLOCK_CONDITIONS** 仅注册了5名英雄的解锁条件:
- warrior (默认解锁)
- archer (默认解锁)
- mage (默认解锁)
- priest (击杀100单位)
- dark_knight (完成1次冒险)

**缺失解锁条件的14名英雄**: assassin, paladin, necromancer, berserker, druid, elementalist, monk, beast_warden, dragon_knight, shadow_weaver, storm_caller, holy_sentinel, ice_mage, thunder_monk

**影响**: 这14名英雄永远无法解锁，玩家只能使用5名英雄中的3名(默认解锁)进行游戏。

### 3.2 数据不一致

| # | 严重程度 | 描述 |
|---|---------|------|
| D-1 | 中等 | enemies.json中有id为"ice_mage"的敌人，与heroes.json中的"ice_mage"英雄ID冲突 |
| D-2 | 中等 | dragon种族羁绊定义了2/4阈值，但仅有1个dragon英雄(dragon_knight)，永远无法触发 |
| D-3 | 轻微 | phoenix_ash遗物effects中type为"on_death_revive"，但RelicSystem可能不识别此类型 |
| D-4 | 轻微 | 多个ultimate级技能(如hero_ultimate类)在skill-advancements.json中无进阶路径 |

---

## 四、跨场景共性问题

| # | 严重程度 | 描述 | 影响范围 |
|---|---------|------|---------|
| C-1 | 严重 | **缺少统一的防重复操作机制**。ShopScene、EventScene、RestScene都在动画过渡期间可重复触发关键操作 | 商店/事件/休息 |
| C-2 | 中等 | children.removeAll()不销毁对象。EventScene和RestScene使用此方法清除内容，不会清理事件监听器和tween | 事件/休息 |
| C-3 | 轻微 | fontFamily:'monospace'在中文环境中依赖浏览器fallback，不同系统显示效果可能不同 | 全局 |

---

## 五、问题汇总按严重程度

### 严重 (5个) — 建议立即修复

1. **[H-2] 14名英雄缺少解锁条件** — 玩家几乎无法体验大部分英雄
2. **[E-1] 事件选项可重复触发** — 可能导致金币扣除/英雄献祭等效果重复执行
3. **[SET-1] 设置场景键盘监听器泄漏** — 内存泄漏 + 可能导致其他场景异常
4. **[R-2] RewardScene battleResult undefined错误** — 控制台报错，特定条件下结算页面异常
5. **[H-1] 英雄选择卡片溢出画布** — 第一张和最后一张卡片超出800px边界

### 中等 (14个) — 建议近期修复

6. [S-1] 商店已售商品可重复购买
7. [E-2] stat_boost绕过升级逻辑
8. [E-3] item事件效果仅给金币
9. [E-4] children.removeAll()不销毁
10. [REST-1] 休息按钮可重复点击
11. [SET-2] 多重绑定会话冲突
12. [SET-3] SettingsScene缺少shutdown
13. [M-1] 升级面板缺遮罩层
14. [R-1] 奖励场景多英雄布局溢出
15. [D-1] ice_mage ID冲突
16. [D-2] dragon羁绊不可触发
17. [H-3] 英雄卡片stat文本未加入容器
18. [E-5] EventScene中文字符串未纳入i18n
19. [C-2] children.removeAll使用模式

### 轻微 (11个) — 可后续优化

20. [M-2] "英雄:X/5"分母硬编码
21. [MAP-1] 地图无拖拽提示
22. [MAP-2] 初始连线不够明显
23. [MAP-3] 英雄面板装备槽使用英文W/A/R
24. [B-1] 初始战斗过快
25. [B-2] 第一个节点可能是商店(新手无金币购买)
26. [S-2] 按钮事件不一致
27. [SET-4] 设置场景硬编码中文
28. [E-6] 事件概率提示文字歧义
29. [D-3] phoenix_ash效果类型
30. [D-4] ultimate技能无进阶

---

## 六、优先修复建议

### 第一优先级 (影响游戏核心体验)

1. **补全14名英雄的解锁条件** — 在 `MetaManager.HERO_UNLOCK_CONDITIONS` 中为每个英雄添加合理的解锁条件
2. **为EventScene添加choiceMade防重入标志** — `makeChoice()`开头检查flag
3. **修复英雄选择网格布局** — 将COLS从10改为合适值，或增加滚动
4. **修复RewardScene battleResult undefined** — 检查数据传递链路

### 第二优先级 (防止玩家利用bug)

5. **ShopScene buyItem添加sold检查** + 禁用已售物品交互
6. **RestScene添加操作锁定** — 点击休息后立即禁用按钮
7. **SettingsScene添加shutdown()** — 清理keydown监听器和tween

### 第三优先级 (完善度)

8. 修复stat_boost绕过升级逻辑
9. 将children.removeAll()改为销毁模式
10. 统一散落的中文字符串到i18n
11. 修复ice_mage ID冲突
12. 添加dragon种族第二个英雄使羁绊可触发

---

## 七、正面亮点

- 全中文UI完成度极高，绝大部分文字已本地化
- 战斗系统自动运行流畅，伤害数字/技能效果/血条更新视觉效果良好
- 地图节点类型丰富(战斗/精英/首领/商店/事件/休息)，3章制进度结构合理
- 英雄选择场景新加入，支持2-3名英雄自选
- 难度系统(4级)有合理的解锁门槛
- 音频系统完善(8首BGM + 9个SFX)，场景切换时自动切换背景音乐
- 底部英雄面板可交互查看详情(HeroDetailPopup)
- 加速按钮位置已修复，不再被技能栏遮挡
- 商店装备对比系统直观(▲/▼箭头 + 颜色区分)
- 事件场景电影式进场动画体验出色
- 休息场景篝火粒子效果和HP颜色分级增强沉浸感
- 战斗场地修饰器增加策略深度
- 速度设置持久化保存(退出后保留)

---

*报告生成时间: 2026-02-28*
*测试方法: 浏览器实际操作(Chrome DevTools MCP) + 代码审查 + 数据完整性审计*
*问题总计: 严重5个 + 中等14个 + 轻微11个 = 30个*
